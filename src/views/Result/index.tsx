"use client";
import { IMAGES } from "@/constants/images";
import { IExam } from "@/models";
import { useLoading } from "@/providers/loadingProvider";
import { examResult } from "@/services";
import { useParams, useRouter } from "next/navigation";
import React, { useEffect, useState } from "react";

const Result = () => {
  const [result, setResult] = useState<IExam>();
  const [currentPage, setCurrentPage] = useState(0);
  const [pageSize, setPageSize] = useState(60);
  const [totalItems, setTotalItems] = useState(0);
  const [totalPages, setTotalPages] = useState(1);
  const [showResult, setShowResult] = useState(false);
  const { setLoading } = useLoading();
  const params = useParams();
  const router = useRouter();
  const fetchResult = async () => {
    try {
      setLoading(true);
      const res = await examResult(params.id, currentPage, pageSize);
      setResult(res.data);
    } catch (e) {
      setLoading(false);
    } finally {
      setLoading(false);
    }
  };
  useEffect(() => {
    fetchResult();
  }, []);
  if (!result) return;

  return (
    <div className="flex flex-col items-center h-[80vh] justify-center w-full">
      {showResult ? (
        <div></div>
      ) : (
        <div className="flex flex-col items-center gap-4  shadow-lg p-8 rounded-lg">
          <img src={IMAGES.logo} alt="logo" />
          <div className="text-2xl border-y py-4">
            {Math.round(result.studentGrade)}/{result.totalGrade}
          </div>
          <div className="flex gap-16">
            <div className="flex items-center gap-4">
              <svg
                width="24"
                height="25"
                viewBox="0 0 24 25"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <g clip-path="url(#clip0_2734_120047)">
                  <path
                    d="M12 0.5C5.36761 0.5 0 5.867 0 12.5C0 19.1323 5.367 24.5 12 24.5C18.6324 24.5 24 19.133 24 12.5C24 5.86761 18.633 0.5 12 0.5ZM12 22.8256C6.30647 22.8256 1.67442 18.1936 1.67442 12.5C1.67442 6.80642 6.30647 2.17442 12 2.17442C17.6936 2.17442 22.3256 6.80642 22.3256 12.5C22.3256 18.1936 17.6936 22.8256 12 22.8256Z"
                    fill="#FDD97B"
                  />
                  <path
                    d="M11.6458 15.6836C10.9824 15.6836 10.4453 16.2364 10.4453 16.8998C10.4453 17.5475 10.9666 18.1161 11.6458 18.1161C12.325 18.1161 12.862 17.5475 12.862 16.8998C12.862 16.2364 12.3092 15.6836 11.6458 15.6836Z"
                    fill="#FDD97B"
                  />
                  <path
                    d="M11.85 6.47559C9.71759 6.47559 8.73828 7.73929 8.73828 8.59223C8.73828 9.20826 9.25953 9.4926 9.686 9.4926C10.539 9.4926 10.1915 8.27629 11.8026 8.27629C12.5924 8.27629 13.2243 8.62382 13.2243 9.35043C13.2243 10.2034 12.3397 10.693 11.8184 11.1353C11.3603 11.5301 10.7601 12.1778 10.7601 13.5362C10.7601 14.3576 10.9813 14.5945 11.6289 14.5945C12.4028 14.5945 12.5608 14.247 12.5608 13.9469C12.5608 13.1255 12.5766 12.6516 13.4454 11.9724C13.8718 11.6407 15.2144 10.5666 15.2144 9.08184C15.2144 7.59707 13.8718 6.47559 11.85 6.47559Z"
                    fill="#FDD97B"
                  />
                </g>
                <defs>
                  <clipPath id="clip0_2734_120047">
                    <rect
                      width="24"
                      height="24"
                      fill="white"
                      transform="translate(0 0.5)"
                    />
                  </clipPath>
                </defs>
              </svg>
              <p>
                Số lượng câu hỏi:{" "}
                <span className="text-gray-800">
                  {result.questions.length} câu
                </span>{" "}
              </p>
            </div>
            <div className="flex items-center gap-4">
              <svg
                width="24"
                height="25"
                viewBox="0 0 24 25"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M12.0513 14.0148C12.2285 14.0148 12.3722 13.8711 12.3722 13.6939C12.3722 13.5167 12.2285 13.373 12.0513 13.373C11.8741 13.373 11.7305 13.5167 11.7305 13.6939C11.7305 13.8711 11.8741 14.0148 12.0513 14.0148Z"
                  fill="#FDD97B"
                />
                <path
                  d="M12.0513 15.2833C12.2285 15.2833 12.3722 15.1397 12.3722 14.9625C12.3722 14.7853 12.2285 14.6416 12.0513 14.6416C11.8741 14.6416 11.7305 14.7853 11.7305 14.9625C11.7305 15.1397 11.8741 15.2833 12.0513 15.2833Z"
                  fill="#FDD97B"
                />
                <path
                  d="M14.3024 11.7458L15.6885 10.4804L16.3533 9.87716C17.5546 8.79395 18.1501 7.32572 18.1732 5.38261V3.7501H19.1794C19.2222 3.75113 19.2647 3.74359 19.3045 3.72792C19.3444 3.71226 19.3806 3.68879 19.4113 3.65889C19.4419 3.62899 19.4662 3.59328 19.4828 3.55384C19.4994 3.5144 19.5079 3.47204 19.5079 3.42925V2.04058C19.5079 1.95549 19.4741 1.87388 19.414 1.8137C19.3538 1.75353 19.2722 1.71973 19.1871 1.71973H4.92056C4.83546 1.71973 4.75385 1.75353 4.69368 1.8137C4.63351 1.87388 4.5997 1.95549 4.5997 2.04058V3.42925C4.5997 3.51434 4.63351 3.59595 4.69368 3.65612C4.75385 3.7163 4.83546 3.7501 4.92056 3.7501H5.92676V5.37748C5.94986 7.31545 6.54794 8.78368 7.74922 9.86433L8.51927 10.5676L9.8027 11.7381C9.93615 11.8385 10.0466 11.9662 10.1268 12.1128C10.2069 12.2593 10.2548 12.4212 10.2673 12.5877C10.2509 12.7596 10.1982 12.9259 10.1128 13.0759C10.0274 13.2259 9.91124 13.3561 9.77189 13.4579L7.74409 15.3112C6.5428 16.3918 5.9473 17.86 5.92163 19.8032V21.22H4.92056C4.87777 21.22 4.8354 21.2286 4.79597 21.2452C4.75653 21.2618 4.72081 21.2861 4.69091 21.3167C4.66101 21.3473 4.63754 21.3836 4.62188 21.4235C4.60622 21.4633 4.59867 21.5058 4.5997 21.5486V22.9373C4.5997 23.0224 4.63351 23.104 4.69368 23.1641C4.75385 23.2243 4.83546 23.2581 4.92056 23.2581H19.1794C19.2228 23.2592 19.266 23.2514 19.3064 23.2353C19.3467 23.2191 19.3833 23.195 19.4141 23.1642C19.4448 23.1335 19.4689 23.0969 19.4851 23.0565C19.5012 23.0162 19.509 22.973 19.5079 22.9296V21.5486C19.5079 21.4635 19.4741 21.3819 19.414 21.3217C19.3538 21.2616 19.2722 21.2277 19.1871 21.2277H18.1732V19.798C18.1501 17.86 17.5546 16.3918 16.3533 15.3112L14.3229 13.4553C14.1848 13.3544 14.0697 13.2254 13.9852 13.0767C13.9007 12.928 13.8487 12.7631 13.8326 12.5929C13.8468 12.4265 13.8959 12.2651 13.9769 12.1191C14.0578 11.9731 14.1688 11.8459 14.3024 11.7458ZM13.1909 12.5954C13.2049 12.8556 13.2747 13.1097 13.3956 13.3404C13.5165 13.5712 13.6857 13.7732 13.8917 13.9328L15.9144 15.786C16.9924 16.7563 17.5032 18.0346 17.5238 19.8032V21.22H6.56847V19.8057C6.59157 18.0346 7.10238 16.7563 8.18045 15.786L10.2083 13.9353C10.4157 13.7745 10.5861 13.5709 10.7079 13.3384C10.8296 13.1058 10.9 12.8499 10.9141 12.5877C10.9012 12.3336 10.8334 12.0853 10.7156 11.8598C10.5978 11.6343 10.4326 11.437 10.2314 11.2812L8.94794 10.1107L8.17788 9.40743C7.10238 8.43716 6.59157 7.15887 6.56847 5.39031V3.7501H17.5315V5.37748C17.5109 7.1486 17.0001 8.42689 15.9221 9.39716C15.6987 9.59737 15.478 9.80015 15.2547 10.0055L13.8609 11.2812C13.6626 11.4404 13.5003 11.6399 13.3848 11.8664C13.2693 12.093 13.2032 12.3415 13.1909 12.5954Z"
                  fill="#FDD97B"
                />
                <path
                  d="M16.2771 7.94463C16.3116 7.88487 16.3258 7.81549 16.3174 7.74697C16.3091 7.67844 16.2787 7.61449 16.2309 7.56474C16.1839 7.51383 16.1214 7.47991 16.0531 7.4683C15.9849 7.45669 15.9147 7.46804 15.8535 7.50057C14.5881 8.14485 14.1132 8.38613 12.1496 7.75725C10.8909 7.34718 9.52256 7.43914 8.33011 8.01394C8.28661 8.03452 8.24829 8.06463 8.21799 8.10204C8.1877 8.13944 8.16621 8.18318 8.15512 8.23002C8.14403 8.27686 8.14362 8.32559 8.15391 8.37261C8.16421 8.41963 8.18495 8.46373 8.21461 8.50164C8.33781 8.64795 11.1305 11.3252 11.1562 11.3252C11.3632 11.563 11.4891 11.8606 11.5156 12.1748C11.5323 12.3055 11.5987 12.4248 11.7009 12.5079C11.8032 12.5911 11.9335 12.6317 12.0649 12.6214C12.1266 12.6274 12.1889 12.6211 12.2482 12.6029C12.3075 12.5847 12.3626 12.555 12.4103 12.5153C12.4581 12.4757 12.4975 12.4271 12.5263 12.3721C12.5551 12.3172 12.5728 12.2571 12.5782 12.1953C12.6276 11.7853 12.8292 11.4088 13.1429 11.1404C13.1866 11.1019 13.3663 10.9299 13.6101 10.6963C14.2108 10.1213 15.2118 9.15618 15.4865 8.9149C15.8003 8.63594 16.0672 8.30834 16.2771 7.94463Z"
                  fill="#FDD97B"
                />
                <path
                  d="M7.63095 20.1936C7.62991 20.2368 7.63761 20.2798 7.65359 20.32C7.66957 20.3601 7.6935 20.3966 7.72395 20.4273C7.75439 20.458 7.79073 20.4822 7.83076 20.4985C7.8708 20.5148 7.91372 20.5229 7.95694 20.5222H16.1477C16.2328 20.5222 16.3145 20.4883 16.3746 20.4282C16.4348 20.368 16.4686 20.2864 16.4686 20.2013C16.4408 19.0478 15.963 17.9509 15.1374 17.1449C14.3117 16.3389 13.2036 15.8877 12.0498 15.8877C10.8959 15.8877 9.78783 16.3389 8.96217 17.1449C8.13651 17.9509 7.65876 19.0478 7.63095 20.2013V20.1936Z"
                  fill="#FDD97B"
                />
              </svg>

              <p>
                Thời gian làm bài:{" "}
                <span className="text-gray-800">{result.length} phút</span>{" "}
              </p>
            </div>
            <div className="flex items-center gap-4">
              <svg
                width="24"
                height="25"
                viewBox="0 0 24 25"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <g clip-path="url(#clip0_2734_120068)">
                  <path
                    d="M6.53333 9.96667L4.66667 11.8333L10.6667 17.8333L24 4.5L22.1333 2.63333L10.6667 14.1L6.53333 9.96667ZM21.3333 21.8333H2.66667V3.16667H16V0.5H2.66667C1.2 0.5 0 1.7 0 3.16667V21.8333C0 23.3 1.2 24.5 2.66667 24.5H21.3333C22.8 24.5 24 23.3 24 21.8333V11.1667H21.3333V21.8333Z"
                    fill="#FDD97B"
                  />
                </g>
                <defs>
                  <clipPath id="clip0_2734_120068">
                    <rect
                      width="24"
                      height="24"
                      fill="white"
                      transform="translate(0 0.5)"
                    />
                  </clipPath>
                </defs>
              </svg>

              <p>
                Số câu đúng:{" "}
                <span className="text-gray-800">
                  {" "}
                  {result.studentCorrectAnswers} câu
                </span>{" "}
              </p>
            </div>
          </div>
          <div className="flex items-center gap-4">
            <div
              className="text-white bg-[#1244A2] px-3 py-3 rounded-xl cursor-pointer"
              onClick={() => setShowResult(true)}
            >
              Kết quả
            </div>
            <div
              className="text-white bg-[#FDB022] px-3 py-3 rounded-xl cursor-pointer"
              onClick={() => router.push("/student/home")}
            >
              Về trang chủ
            </div>
          </div>
        </div>
      )}
    </div>
  );
};

export default Result;
